FROM ubuntu
RUN apt update && DEBIAN_FRONTEND=noninteractive apt install -y --no-install-recommends libssh2-1-dev freerdp2-dev libossp-uuid-dev libtool-bin libpng-dev libjpeg-turbo8-dev libcairo2-dev  openjdk-8-jdk libssh2-1-dev freerdp2-dev sudo wget curl 
RUN wget https://archive.apache.org/dist/tomcat/tomcat-10/v10.1.9/bin/apache-tomcat-10.1.9.tar.gz &&  mkdir /opt/tomcat && sudo tar -xzf apache*.tar.gz -C /opt/tomcat/ && rm apache-tomcat* && mv /opt/tomcat/apache-tomcat* /opt/tomcat/tomcatapp && chmod +x /opt/tomcat/tomcatapp && rm -rf  /opt/tomcat/tomcatapp/webapps && mkdir -p /opt/tomcat/tomcatapp/webapps/ROOT 
RUN cd /opt/tomcat/tomcatapp/webapps/ROOT && wget https://dlcdn.apache.org/guacamole/1.5.5/binary/guacamole-1.5.5.war  && jar -xvf *.war  && rm *.war && mkdir -p /etc/guacamole/ && cd /etc/guacamole && wget https://raw.githubusercontent.com/amitstudydude/RDP_Linux/main/guacamole.properties && wget https://raw.githubusercontent.com/amitstudydude/RDP_Linux/main/user-mapping.xml  && sed -i 's/localhost/172.17.0.1/g' /etc/guacamole/user-mapping.xml && cat /etc/guacamole/user-mapping.xml  && sed -i 's/127.0.0.1/172.17.0.1/g' /etc/guacamole/guacamole.properties && export GUACAMOLE_HOME=/etc/guacamole  && apt clean && apt autoremove && rm -rf /var/lib/apt/lists/* 
EXPOSE 8080/tcp
CMD /opt/tomcat/tomcatapp/bin/catalina.sh run